<!-- src/app/nurse/pages/nurse-prescriptions/nurse-prescriptions.component.html -->
<mat-card class="card">
    <div class="flex-between">
      <h2>Prescriptions</h2>
      <a mat-stroked-button [routerLink]="['/nurse','patients', patientId]">
        <mat-icon>arrow_back</mat-icon>&nbsp;Retour patient
      </a>
    </div>
  
    <!-- Formulaire ajout -->
    <form [formGroup]="form" (ngSubmit)="addRx()" class="grid">
      <mat-form-field>
        <mat-label>Nom (médicament)</mat-label>
        <input matInput formControlName="name" required />
      </mat-form-field>
  
      <mat-form-field>
        <mat-label>Dosage</mat-label>
        <input matInput formControlName="dose" placeholder="500 mg"/>
      </mat-form-field>
  
      <mat-form-field>
        <mat-label>Voie</mat-label>
        <input matInput formControlName="route" placeholder="PO / IV / IM"/>
      </mat-form-field>
  
      <mat-form-field>
        <mat-label>Fréquence</mat-label>
        <input matInput formControlName="frequency" placeholder="BID / q8h / PRN"/>
      </mat-form-field>
  
      <mat-form-field>
        <mat-label>Début</mat-label>
        <input matInput [matDatepicker]="sd" formControlName="startDate"/>
        <mat-datepicker-toggle matSuffix [for]="sd"></mat-datepicker-toggle>
        <mat-datepicker #sd></mat-datepicker>
      </mat-form-field>
  
      <mat-form-field>
        <mat-label>Fin</mat-label>
        <input matInput [matDatepicker]="ed" formControlName="endDate"/>
        <mat-datepicker-toggle matSuffix [for]="ed"></mat-datepicker-toggle>
        <mat-datepicker #ed></mat-datepicker>
      </mat-form-field>
  
      <mat-form-field class="wide">
        <mat-label>Notes</mat-label>
        <textarea matInput formControlName="notes" rows="1"></textarea>
      </mat-form-field>
  
      <div class="row-actions">
        <button mat-raised-button color="primary" type="submit" [disabled]="loading || form.invalid">
          <mat-icon>add</mat-icon>&nbsp;Ajouter
        </button>
        <mat-spinner *ngIf="loading" diameter="28"></mat-spinner>
      </div>
    </form>
  
    <!-- Table -->
    <div class="table-wrap">
      <table mat-table [dataSource]="(items$ | async) ?? []" class="mat-elevation-z2 full-table">
  
        <ng-container matColumnDef="name">
          <th mat-header-cell *matHeaderCellDef>Nom</th>
          <td mat-cell *matCellDef="let r">{{ r.name }}</td>
        </ng-container>
  
        <ng-container matColumnDef="dose">
          <th mat-header-cell *matHeaderCellDef>Dosage</th>
          <td mat-cell *matCellDef="let r">{{ r.dose || '—' }}</td>
        </ng-container>
  
        <ng-container matColumnDef="route">
          <th mat-header-cell *matHeaderCellDef>Voie</th>
          <td mat-cell *matCellDef="let r">{{ r.route || '—' }}</td>
        </ng-container>
  
        <ng-container matColumnDef="frequency">
          <th mat-header-cell *matHeaderCellDef>Fréquence</th>
          <td mat-cell *matCellDef="let r">{{ r.frequency || '—' }}</td>
        </ng-container>
  
        <ng-container matColumnDef="startDate">
          <th mat-header-cell *matHeaderCellDef>Début</th>
          <td mat-cell *matCellDef="let r">{{ toDate(r.startDate) | date:'yyyy-MM-dd' }}</td>
        </ng-container>
  
        <ng-container matColumnDef="endDate">
          <th mat-header-cell *matHeaderCellDef>Fin</th>
          <td mat-cell *matCellDef="let r">{{ toDate(r.endDate)   | date:'yyyy-MM-dd' }}</td>
        </ng-container>
  
        <ng-container matColumnDef="notes">
          <th mat-header-cell *matHeaderCellDef>Notes</th>
          <td mat-cell *matCellDef="let r" class="truncate" [title]="r.notes">{{ r.notes || '—' }}</td>
        </ng-container>
  
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef>Actions</th>
          <td mat-cell *matCellDef="let r">
            <button mat-button color="primary" disabled><mat-icon>edit</mat-icon>&nbsp;Éditer</button>
            <button mat-button color="warn" disabled><mat-icon>delete</mat-icon>&nbsp;Supprimer</button>
          </td>
        </ng-container>
  
        <tr mat-header-row *matHeaderRowDef="displayed"></tr>
        <tr mat-row *matRowDef="let row; columns: displayed"></tr>
      </table>
    </div>
  </mat-card>
  